(function(){window.api_call=function(n,e,t,i,r){var o,a,u;r=r||i||t,i=i||t,4===arguments.length&&(i=void 0),3===arguments.length&&(t=void 0,i=void 0),t=t||{};for(o in t)u=t[o],null==u&&delete t[o];return a=e.search("\\?")>=0?"&":"?",$.ajax({type:n,url:""+e+a+$.param(t),contentType:"application/json",accepts:"application/json",dataType:"json",data:i?JSON.stringify(i):void 0,success:function(e){var t;return"success"===e.status?(t=void 0,e.next_url&&(t=function(t){return api_call(n,e.next_url,{},t)}),"function"==typeof r?r(void 0,e.result,t):void 0):"function"==typeof r?r(e):void 0},error:function(n,e,t){var i,o,a;o={error_code:"ajax_error",text_status:e,error_thrown:t,jqXHR:n};try{n.responseText&&(o=$.parseJSON(n.responseText))}catch(a){i=a,o=o}return LOG("api_call error",o),"function"==typeof r?r(o):void 0}})}}).call(this),function(){window.LOG=function(){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log.apply(console,arguments):void 0},window.init_common=function(){return init_loading_button(),init_password_show_button(),init_time(),init_announcement(),init_row_link()},window.init_loading_button=function(){return $("body").on("click",".btn-loading",function(){return $(this).button("loading")})},window.init_password_show_button=function(){return $("body").on("click",".btn-password-show",function(){var n;return n=$($(this).data("target")),n.focus(),$(this).hasClass("active")?n.attr("type","password"):n.attr("type","text")})},window.init_time=function(){var n;return $("time").length>0?(n=function(){return $("time[datetime]").each(function(){var n,e;return n=moment.utc($(this).attr("datetime")),e=moment().diff(n,"days"),e>25?$(this).text(n.local().format("YYYY-MM-DD")):$(this).text(n.fromNow()),$(this).attr("title",n.local().format("dddd, MMMM Do YYYY, HH:mm:ss Z"))}),setTimeout(arguments.callee,45e3)})():void 0},window.init_announcement=function(){return $(".alert-announcement button.close").click(function(){return"undefined"!=typeof sessionStorage&&null!==sessionStorage?sessionStorage.setItem("closedAnnouncement",$(".alert-announcement").html()):void 0}),("undefined"!=typeof sessionStorage&&null!==sessionStorage?sessionStorage.getItem("closedAnnouncement"):void 0)!==$(".alert-announcement").html()?$(".alert-announcement").show():void 0},window.init_row_link=function(){return $("body").on("click",".row-link",function(){return window.location.href=$(this).data("href")}),$("body").on("click",".not-link",function(n){return n.stopPropagation()})},window.clear_notifications=function(){return $("#notifications").empty()},window.show_notification=function(n,e){return null==e&&(e="warning"),clear_notifications(),n?$("#notifications").append('<div class="alert alert-dismissable alert-'+e+'">\n  <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>\n  '+n+"\n</div>"):void 0}}.call(this),function(){window.init_admin_config=function(){}}.call(this),function(){$(function(){return init_common()}),$(function(){return $("html.welcome").each(function(){return LOG("init welcome")})}),$(function(){return $("html.auth").each(function(){return init_auth()})}),$(function(){return $("html.feedback").each(function(){})}),$(function(){return $("html.user-list").each(function(){return init_user_list()})}),$(function(){return $("html.user-merge").each(function(){return init_user_merge()})}),$(function(){return $("html.admin-config").each(function(){return init_admin_config()})})}.call(this),function(){window.init_auth=function(){return $(".remember").change(function(){var n,e,t,i,r,o;for(e=$(".btn-social").toArray().concat($(".btn-social-icon").toArray()),o=[],i=0,r=e.length;r>i;i++)n=e[i],t=$(n).prop("href"),$(".remember input").is(":checked")?($(n).prop("href",t+"&remember=true"),o.push($("#remember").prop("checked",!0))):($(n).prop("href",t.replace("&remember=true","")),o.push($("#remember").prop("checked",!1)));return o}),$(".remember").change()}}.call(this),function(){var n,e,t,i,r,o;window.init_user_list=function(){return t(),n(),e()},t=function(){return $("input[name=user_db]").each(function(){return o($(this))}),$("#select-all").change(function(){return $("input[name=user_db]").prop("checked",$(this).is(":checked")),$("input[name=user_db]").each(function(){return o($(this))})}),$("input[name=user_db]").change(function(){return o($(this))})},o=function(n){return r(),$("input[name=user_db]").each(function(){var e;return e=n.val(),$("#"+e).toggleClass("warning",n.is(":checked"))})},r=function(){var n;return n=$("input[name=user_db]:checked").length,$("#user-actions").toggleClass("hidden",0===n),$("#user-merge").toggleClass("hidden",2>n),0===n?($("#select-all").prop("indeterminate",!1),$("#select-all").prop("checked",!1)):0===$("input[name=user_db]:not(:checked)").length?($("#select-all").prop("indeterminate",!1),$("#select-all").prop("checked",!0)):$("#select-all").prop("indeterminate",!0)},n=function(){return $("#user-delete").click(function(n){var e,t,i,o,a;return clear_notifications(),n.preventDefault(),e=$(this).data("confirm").replace("{users}",$("input[name=user_db]:checked").length),confirm(e)?(a=[],$("input[name=user_db]:checked").each(function(){return $(this).attr("disabled",!0),a.push($(this).val())}),t=$(this).data("api-url"),o=$(this).data("success"),i=$(this).data("error"),api_call("DELETE",t,{user_keys:a.join(",")},function(n,e){return n?($("input[name=user_db]:disabled").removeAttr("disabled"),void show_notification(i.replace("{users}",a.length),"danger")):$("#"+e.join(", #")).fadeOut(function(){return $(this).remove(),r(),show_notification(o.replace("{users}",a.length),"success")})})):void 0})},window.init_user_merge=function(){var n,e;return e=$("#user_keys").val(),n=$(".api-url").data("api-url"),api_call("GET",n,{user_keys:e},function(n,e){return n?void LOG("Something went terribly wrong"):(window.user_dbs=e,$("input[name=user_db]").removeAttr("disabled"))}),$("input[name=user_db]").change(function(n){var e;return e=$(n.currentTarget).val(),i(e)})},i=function(n){var e,t,i,r;for($(".user-row").removeClass("success").addClass("danger"),$("#"+n).removeClass("danger").addClass("success"),i=[],e=0,t=user_dbs.length;t>e;e++){if(r=user_dbs[e],n===r.key){$("input[name=user_key]").val(r.key),$("input[name=username]").val(r.username),$("input[name=name]").val(r.name),$("input[name=email]").val(r.email);break}i.push(void 0)}return i},e=function(){return $("#user-merge").click(function(n){var e,t;return n.preventDefault(),e=[],$("input[name=user_db]:checked").each(function(){return e.push($(this).val())}),t=$(this).data("user-merge-url"),window.location.href=t+"?user_keys="+e.join(",")})}}.call(this);